{% extends "base.html" %}
{% block title %}–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥{% endblock %}
{% block content %}
<h2>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h2>

<div id="stats"></div>
<div id="robots"></div>
<div id="scans"></div>

<script>
async function loadDashboard() {
  const res = await fetch("/api/dashboard/current");
  const data = await res.json();

  const statsDiv = document.getElementById("stats");
  statsDiv.innerHTML = `
    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
    <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ä–æ–±–æ—Ç–æ–≤: ${data.statistics.active_robots}</p>
    <p>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏: ${data.statistics.critical_stock}</p>
    <p>–°—Ä–µ–¥–Ω–∏–π –∑–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ–π: ${data.statistics.avg_battery}%</p>
  `;

  const robotsDiv = document.getElementById("robots");
  robotsDiv.innerHTML = "<h3>–†–æ–±–æ—Ç—ã</h3>" + data.robots.map(r => `
    <div>
      ü§ñ <b>${r.id}</b> ‚Äî –∑–æ–Ω–∞ ${r.zone}, –∑–∞—Ä—è–¥ ${r.battery}%
    </div>
  `).join("");

  const scansDiv = document.getElementById("scans");
  scansDiv.innerHTML = "<h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>" +
    data.recent_scans.map(s => `
      <div>
        ${s.time} | ${s.robot_id} | ${s.product} (${s.quantity}) ‚Äî ${s.status}
      </div>
    `).join("");
}

setInterval(loadDashboard, 5000);
loadDashboard();
</script>
{% endblock %}
